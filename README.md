# dynamic ion container

## 需求分析

1. 支持从json文件导入IoC容器配置。(可配置)
2. 支持从@Service注解导入配置。（默认从当前包进行注解的扫描）
2. 进行DI时支持属性注入和构造器注入，在进行构造器注入时，存在多个构造器时支持通过注解配置来解决。
3. 支持单例服务的提前加载和延迟加载。（默认为延迟加载，和单例模式）
4. 使用IOption<T>接口支持配置的注入。
5. (实验性)使用IDynamicOption<T>接口支持动态配置（可感知配置的改变）。
6. 支持Transient、Singleton和Scoped三种作用域的服务。
7. 支持作用域的定义。
7. (实验性)支持动态的修改服务的配置（修改服务的配置后，将会导致可用服务配置的修改）。

## 功能实现

| 实现进度 | 功能优先级 | 功能简介 |
| --- | --- | --- | 
| √ | 高 | 基于注解的服务实现 | 
| x | 中 | 基于json文件的服务实现 |
| √ | 高 | 支持单例服务 |
| √ | 高 | 支持瞬态服务 |
| √ | 高 | 支持作用域级的服务 | 
| √ | 高 | 支持构造器注入（不推荐）|
| √ | 高 | 支持属性注入（推荐） |
| √ | 高 | 支持单例服务和作用域级服务的延迟加载和立即加载 |
| √ | 高 | 支持直接注入和代理注入的两种方式（代理注入又称延迟注入） |
| √ | 低 | 生命周期感知接口，当一个对象初始化完成和即将退出生命周期（不做了）时可以感知 |
| √ | 中 | 执行结构检查 |

注解：

1. 当Singleton服务引用Transient服务时，应当立即创建一个Transient服务单例。
   Transient服务应当是弱跟踪的。(即在storage中使用WeakReference获取对象。)
2. 当Singleton服务引用Scope服务时，将会产生很多问题，当Scope发生变化时应当使用服务感知。
   一般有两种实现方式，一种是当Scope发生更改时，重新进行注入。另外一种是使用动态代理来进行注入（只能动态代理接口）。
   一般来说动态代理的方式更加通用和简单。我们这里使用动态代理来实现。
3. 关于代理注入的问题：可以很好地解决构造器循环构造死锁的问题。
   当使用代理注入时，将禁止在构造期间访问代理注入对象。
   Scoped的服务仅支持代理注入。